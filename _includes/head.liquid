<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta charset="utf-8">

    <!-- Icon -->
    <link rel="apple-touch-icon" href="{{ site.logo | absolute_url }}">
    <link rel="icon" type="image/png" href="{{ site.logo | absolute_url }}">

    <!-- Assets, SEO, and Feed -->
    {% inject_assets %}
    {% feed_meta %}
    {% seo %}

    <!-- Prevent FOUC, init AOS and init Fuse.js -->
    <style>html{visibility: hidden;opacity:0;}</style>
    <script>
        window.siteSearch = null;

        function runSearch(query) {
            if (!window.siteSearch || !query.trim()) return null;
            return window.siteSearch.search(query);
        }

        async function create_search() {
            await fetch('{{ "/search.json" | absolute_url }}')
            .then(res => res.json())
            .then(data => {
                window.siteSearch = new Fuse(data, {
                keys: [
                    { name: 'title', weight: 0.5 },
                    { name: 'description', weight: 0.3 },
                    { name: 'content', weight: 0.2 }
                ],
                threshold: 0.3,
                ignoreLocation: true
                });
            });
        }

        document.addEventListener('DOMContentLoaded', function() {
            document.documentElement.style.visibility = 'visible';
            document.documentElement.style.opacity = 1;
            AOS.init();
            create_search();

            document.getElementById('search-input').addEventListener('input', function () {
                const results = runSearch(this.value);
                const resultsContainer = document.getElementById('results-container');
                resultsContainer.innerHTML = '';
                results.forEach(r => {
                    const item = r.item; // from search.json
                    const li = document.createElement('li');
                    li.className = 'list-group-item list-group-item-action px-3 py-2';
                    li.innerHTML = `<a href="${item.url}" class="text-decoration-none d-block text-dark">${item.title}</a>`;
                    resultsContainer.appendChild(li);
                });
            });
        });
    </script>
</head>